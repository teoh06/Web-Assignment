@model IEnumerable<dynamic>
@using System.Globalization

<div class="admin-sales-summary theme-aware">
    @if (Model != null && Model.Any())
    {
        var totalQuantity = 0;
        var totalRevenue = (decimal)Model.Sum(x => (decimal)x.Total);
        var avgDailyRevenue = totalRevenue / Model.Count();
        foreach (var day in Model)
        {
            foreach (var item in day.Items)
            {
                totalQuantity += (int)item.Quantity;
            }
        }

        <div class="sales-summary-header">
            <div class="section-title">
                <h2 class="admin-subtitle"><i class="fas fa-chart-bar"></i> Sales Analytics</h2>
                <p class="section-description">Comprehensive overview of sales performance and trends</p>
            </div>
            
            <div class="sales-metrics-grid">
                <div class="metric-card revenue">
                    <div class="metric-icon">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                    <div class="metric-content">
                        <span class="metric-value">@totalRevenue.ToString("C", new CultureInfo("en-MY"))</span>
                        <span class="metric-label">Total Revenue</span>
                    </div>
                </div>
                
                <div class="metric-card orders">
                    <div class="metric-icon">
                        <i class="fas fa-shopping-cart"></i>
                    </div>
                    <div class="metric-content">
                        <span class="metric-value">@totalQuantity</span>
                        <span class="metric-label">Total Items Sold</span>
                    </div>
                </div>
                
                <div class="metric-card average">
                    <div class="metric-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="metric-content">
                        <span class="metric-value">@avgDailyRevenue.ToString("C", new CultureInfo("en-MY"))</span>
                        <span class="metric-label">Avg Daily Revenue</span>
                    </div>
                </div>
                
                <div class="metric-card period">
                    <div class="metric-icon">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <div class="metric-content">
                        <span class="metric-value">@Model.Count()</span>
                        <span class="metric-label">Days Tracked</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="sales-timeline">
            @foreach (var day in Model)
            {
                <div class="day-card">
                    <div class="day-card-header">
                        <div class="date-section">
                            <div class="date-primary">@(((DateTime)day.Date).ToString("dd"))</div>
                            <div class="date-secondary">
                                <span class="month">@(((DateTime)day.Date).ToString("MMM"))</span>
                                <span class="year">@(((DateTime)day.Date).ToString("yyyy"))</span>
                            </div>
                        </div>
                        <div class="daily-summary">
                            <div class="daily-total">@day.Total.ToString("C", new CultureInfo("en-MY"))</div>
                            @{
                                var items = (IEnumerable<dynamic>)day.Items;
                                var dailyItemsSold = items.Sum(i => (int)i.Quantity);
                            }
                            <div class="daily-items">@dailyItemsSold items sold</div>
                        </div>
                    </div>
                    
                    <div class="day-card-body">
                        <div class="products-grid">
                            @foreach (var item in day.Items)
                            {
                                <div class="product-item">
                                    <div class="product-info">
                                        <span class="product-name">@item.Product</span>
                                        <span class="product-quantity">Ã—@item.Quantity</span>
                                    </div>
                                    <div class="product-amount">@item.Amount.ToString("C", new CultureInfo("en-MY"))</div>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            }
        </div>

        <div class="sales-actions">
            <a asp-action="SalesReport" class="btn btn-primary action-btn">
                <i class="fas fa-download"></i> Download PDF Report
            </a>
            <button class="btn btn-info action-btn" onclick="window.print()">
                <i class="fas fa-print"></i> Print Summary
            </button>
        </div>
    }
    else
    {
        <div class="no-data-message theme-aware">
            <div class="no-data-icon">
                <i class="fas fa-chart-bar"></i>
            </div>
            <h3>No Sales Data Available</h3>
            <p>There are no sales records for the selected period. Sales data will appear here once orders are processed.</p>
        </div>
    }
</div>
